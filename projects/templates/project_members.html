{% extends "newBase.html" %}
{% load static %}
{% block title %}Members{% endblock %}
{% load render_table from django_tables2 %}
{% block content %}
<style>
  dialog {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    border-radius: 4px;
    padding: 1rem;
  }
</style>
<script>
// from https://stackoverflow.com/a/57463812
function dialogClickHandler(e) {
    if (e.target.tagName !== 'DIALOG') //This prevents issues with forms
        return;

    const rect = e.target.getBoundingClientRect();

    const clickedInDialog = (
        rect.top <= e.clientY &&
        e.clientY <= rect.top + rect.height &&
        rect.left <= e.clientX &&
        e.clientX <= rect.left + rect.width
    );

    if (clickedInDialog === false)
        e.target.close();
}

for (const dialog of document.querySelectorAll("dialog")) {
    dialog.addEventListener("click", dialogClickHandler);
}
</script>
<main class="main-content">
  <section class="section">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h2 class="section-title">Members</h2>
    </div>
    {% for table in tables %}
      <div style="display: flex; justify-content: space-between; align-items: center;">
          <h3 class="section-title">{{table.table_name}}</h3>
          <button onclick="document.getElementById('add-member-dialog-{{table.team_id}}').showModal()" class="button button-primary">TODO: Add Member</button>
      </div>
      <dialog id="add-member-dialog-{{table.team_id}}">
        <form method="dialog">
            <button>OK</button>
          </form>
        <h3>Add Members to {{table.table_name}}</h3>

          <p>
            <label>
              Search by name or username:
              <input class="member-search" 
                autofocus
                type="search"
                     name="search" placeholder="Begin Typing To Search Users..."
                     hx-get="/projects/team/{{table.team_id}}/new_member_search"
                     hx-trigger="input changed delay:500ms, keyup[key=='Enter']"
                     hx-target="#member-search-results-{{table.team_id}}"
                     hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                     hx-params="*"
              />
            </label>
          </p>
          
          <div id="member-search-results-{{table.team_id}}" style="overflow-y: scroll;">
          </div>
          

      </dialog>
      {% render_table table %}
    {% endfor %}
   </section>
</main>
{%endblock%}